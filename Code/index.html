<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Code Challenge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="../Sources/Images/Code.png" type="image/png" />
  <style>
    :root {
      --bg-primary: #0d0d0d;
      --bg-secondary: #1a1a1a;
      --card-bg: rgba(26, 26, 26, 0.9);
      --accent: #fca311;
      --text-light: #d0d0d0;
      --text-muted: #8a8a8a;
      --transition-duration: 0.3s;
      --border-radius: 8px;
      --color-wrong: #ff4444;
      --color-correct: #4caf50;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      min-height: 100vh;
      font-family: "Poppins", sans-serif;
      color: var(--text-light);
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }
    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 40px;
      background: rgba(26, 26, 26, 0.7);
      backdrop-filter: blur(5px);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header-logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      transition: transform var(--transition-duration) ease;
    }
    .header-logo:hover {
      transform: scale(1.1);
    }
    .return-button {
      background: none;
      color: var(--accent);
      padding: 8px 16px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      border: 1px solid var(--accent);
      border-radius: var(--border-radius);
      transition: background var(--transition-duration) ease, color var(--transition-duration) ease;
    }
    .return-button:hover {
      background: var(--accent);
      color: var(--bg-primary);
    }
    /* Main */
    main {
      flex: 1 0 auto;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .section-label {
      font-size: 1.1rem;
      text-align: center;
      color: var(--text-muted);
      margin: 20px 0;
      line-height: 1.6;
    }
    .quiz-container {
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      backdrop-filter: blur(5px);
      width: 100%;
      text-align: center;
      transition: transform var(--transition-duration) ease, box-shadow var(--transition-duration) ease;
      margin-bottom: 20px;
    }
    .quiz-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.7);
    }
    h2 {
      font-size: 2rem;
      color: var(--accent);
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
    }
    p, ul {
      font-size: 1rem;
      color: var(--text-light);
      line-height: 1.5;
      margin-bottom: 15px;
      text-align: center;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      margin: 8px 0;
    }
    #question-number {
      font-size: 1.2rem;
      color: var(--accent);
      margin-bottom: 5px;
    }
    #score-display {
      font-size: 1rem;
      color: var(--text-muted);
      margin-bottom: 15px;
    }
    #question-text {
      font-size: 1.4rem;
      margin: 15px 0;
      font-weight: 500;
    }
    #options button {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      background: var(--bg-secondary);
      color: var(--text-light);
      border: 1px solid var(--accent);
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: background var(--transition-duration), color var(--transition-duration);
    }
    #options button:hover {
      background: var(--accent);
      color: var(--bg-primary);
    }
    #feedback {
      margin: 15px 0;
      font-size: 1.1rem;
    }
    #nextQuestion, .session-button {
      background: var(--accent);
      color: var(--bg-primary);
      padding: 10px 20px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: opacity var(--transition-duration);
      margin: 5px;
    }
    /* Centrer le bouton "Question Suivante" */
    #nextQuestion {
      display: block;
      margin: 10px auto;
    }
    .session-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    /* Styles pour les erreurs en fin de quiz */
    .error-item {
      margin-bottom: 15px;
      text-align: center;
    }
    .wrong-answer {
      color: var(--color-wrong);
      font-weight: 600;
    }
    .correct-answer {
      color: var(--color-correct);
      font-weight: 600;
    }
    /* Footer */
    footer {
      flex-shrink: 0;
      width: 100%;
      background: transparent;
      padding: 15px 0;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    footer p {
      margin: 5px 0;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
      transition: color var(--transition-duration) ease;
    }
    footer a:hover {
      color: var(--text-light);
    }
    /* Responsive */
    @media (max-width: 768px) {
  /* Fond et global */
  html, body {
    background: linear-gradient(135deg, #0d0d0d, #1a1a1a);
    min-height: 100vh;
  }

  /* Header : logo et bouton sur une seule ligne */
  header {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
    background: rgba(26, 26, 26, 0.9);
  }
  .header-logo {
    width: 50px;
    height: 50px;
  }
  .header-right {
    text-align: right;
  }

  /* Contenu principal */
  main {
    margin: 10px;
    padding: 15px;
  }

  /* Typographie */
  h2 {
    font-size: 1.8rem;
  }
  #question-text {
    font-size: 1.2rem;
  }

  /* Boutons et quiz */
  #options button {
    padding: 10px;
    font-size: 0.9rem;
  }
  .quiz-container {
    padding: 15px;
  }
  .session-button {
    padding: 8px 16px;
    font-size: 0.9rem;
  }

  /* Erreurs */
  .error-item {
    margin-bottom: 10px;
  }
}
  </style>
</head>
<body>
  <header>
    <a href="../index.html">
      <img src="../Sources/Images/jerome.png" alt="Logo" class="header-logo" />
    </a>
    <div class="header-right">
      <a href="../Projet/index.html" class="return-button">Projets</a>
    </div>
  </header>

  <main>
    <section id="instructions" class="section-label">
      <h2>Test du Code de la Route Français</h2>
      <div class="session-buttons">
        <button class="session-button" onclick="selectSession(1)">Session 1</button>
        <button class="session-button" onclick="selectSession(2)">Session 2</button>
        <button class="session-button" onclick="selectSession(3)">Session 3 (Questions les plus dures du code)</button>
      </div>
      <p style="margin-top: 20px;">
        Ce quiz évalue vos connaissances du Code de la Route à travers 40 questions à choix multiples. Vous êtes éliminé après 5 erreurs ou à la fin des 40 questions.
      </p>
      <p>
        Les questions seront mises à jour régulièrement. Aucun visuel n’est utilisé (budget limité).<br />
        Pas d’inscription ni de paiement requis – compatible PC et mobile.<br />
        Créé par Sylvain Hirtz pour <a href="https://archivefever.work" target="_blank" style="color: var(--accent); text-decoration: none;">ArchiveFever.work</a>.<br />
        De nouvelles sessions seront ajoutées progressivement.
      </p>
    </section>

    <section id="quiz" class="quiz-container" style="display: none;">
      <div id="question-number"></div>
      <div id="score-display"></div>
      <div id="question-text"></div>
      <div id="options"></div>
      <div id="feedback" style="display: none;"></div>
      <button id="nextQuestion" style="display: none;">Question Suivante</button>
    </section>

    <section id="result" class="section-label" style="display: none;"></section>
  </main>

  <footer>
    <p>© 2025 ArchiveFever.work - Tous droits réservés</p>
    <p>
      <a href="https://x.com/infinity_lbrtr" target="_blank">X</a> |
      <a href="https://www.instagram.com/infinity_lbrtr" target="_blank">Instagram</a> |
      <a href="https://www.twitch.tv/feveeeer" target="_blank">Twitch</a> |
      <a href="https://www.youtube.com/@Infinity_lbrtr" target="_blank">YouTube</a>
    </p>
  </footer>

  <script>
    let currentSessionData = null;
    let currentQuestionIndex = 0;
    let correctAnswers = 0;
    let errors = 0;
    const maxErrors = 5;
    const quizLength = 40;
    let errorList = []; // Stocke les erreurs sous forme d'objets

    // Charge le JSON et démarre la session
    function selectSession(sessionNumber) {
      let fileName = "";
      if (sessionNumber === 1) {
        fileName = "session1.json";
      } else if (sessionNumber === 2) {
        fileName = "session2.json";
      } else if (sessionNumber === 3) {
        fileName = "session3.json";
      } else {
        alert("Session inconnue.");
        return;
      }
      fetch(fileName)
        .then(response => response.json())
        .then(data => {
          currentSessionData = data;
          if (currentSessionData.length >= quizLength) {
            // Réinitialisation
            currentQuestionIndex = 0;
            correctAnswers = 0;
            errors = 0;
            errorList = [];
            document.getElementById("instructions").style.display = "none";
            document.getElementById("quiz").style.display = "block";
            showQuestion();
          } else {
            alert("Erreur : la session sélectionnée n'a pas assez de questions (40 nécessaires).");
          }
        })
        .catch(error => console.error("Erreur lors du chargement du JSON :", error));
    }

    function showQuestion() {
      if (currentQuestionIndex >= quizLength || errors >= maxErrors) {
        showResult();
        return;
      }
      const question = currentSessionData[currentQuestionIndex];
      document.getElementById("question-number").textContent = `Question ${currentQuestionIndex + 1} / ${quizLength}`;
      document.getElementById("score-display").textContent = `Fautes : ${errors}`;
      document.getElementById("question-text").textContent = question.question;

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";
      question.options.forEach((option, index) => {
        const button = document.createElement("button");
        button.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
        button.addEventListener("click", () => selectAnswer(question, option, question.correctAnswer));
        optionsDiv.appendChild(button);
      });
      document.getElementById("feedback").style.display = "none";
      document.getElementById("nextQuestion").style.display = "none";
    }

    function selectAnswer(question, selected, correct) {
      const feedbackDiv = document.getElementById("feedback");
      if (selected === correct) {
        correctAnswers++;
        currentQuestionIndex++;
        showQuestion();
      } else {
        errors++;
        // Enregistrer la question, la réponse donnée et la bonne réponse
        errorList.push({
          question: question.question,
          selected: selected,
          correct: correct
        });
        // Mise à jour immédiate du compteur de fautes
        document.getElementById("score-display").textContent = `Fautes : ${errors}`;
        feedbackDiv.style.display = "block";
        feedbackDiv.style.color = "var(--color-wrong)";
        feedbackDiv.textContent = `Faux ! La bonne réponse était : ${correct}`;
        document.getElementById("nextQuestion").style.display = "block";
      }
    }

    document.getElementById("nextQuestion").addEventListener("click", () => {
      currentQuestionIndex++;
      showQuestion();
    });

    function showResult() {
      document.getElementById("quiz").style.display = "none";
      const resultDiv = document.getElementById("result");
      resultDiv.style.display = "block";
      let resultHTML = `<h2>Résultat</h2>`;
      resultHTML += `<p>Réponses correctes : ${correctAnswers} / ${quizLength}<br>Fautes : ${errors}</p>`;
      if (errorList.length > 0) {
        resultHTML += `<h3>Vos erreurs :</h3><ul style="text-align:center;">`;
        errorList.forEach((err, index) => {
          resultHTML += `
            <li class="error-item">
              <strong>Q${index + 1}:</strong> ${err.question}<br>
              <em>Votre réponse:</em> <span class="wrong-answer">${err.selected}</span><br>
              <em>Bonne réponse:</em> <span class="correct-answer">${err.correct}</span>
            </li>
          `;
        });
        resultHTML += `</ul>`;
      }
      resultHTML += `<button class="session-button" onclick="restartQuiz()">Recommencer</button>`;
      resultDiv.innerHTML = resultHTML;
    }

    function restartQuiz() {
      document.getElementById("result").style.display = "none";
      document.getElementById("quiz").style.display = "none";
      document.getElementById("instructions").style.display = "block";
    }
  </script>
</body>
</html>
