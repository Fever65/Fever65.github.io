<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR</title>

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000;
      --border:#222;
      --txt:#fff;
      --muted:#9a9a9a;
      --accent:#ff8c00;
      --r:14px;
      --gap:12px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Source Code Pro", monospace;
      background: var(--bg);
      color: var(--txt);
      padding: 14px;
      display:flex;
      justify-content:center;
    }
    .app{width:min(980px, 100%); display:flex; flex-direction:column; gap: var(--gap);}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 12px;
      border:1px solid var(--border);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    .title{font-weight:700; letter-spacing:.5px; text-transform:uppercase; font-size:.9rem;}
    .header-actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
    .chip{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      padding:10px 12px;
      border-radius: 999px;
      cursor:pointer;
      font: inherit;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.5px;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      white-space:nowrap;
      user-select:none;
    }
    .chip:active{transform:scale(.99)}
    .grid{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap: var(--gap);
      align-items:start;
    }
    .card{
      border:1px solid var(--border);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      overflow:hidden;
    }
    .card-h{
      padding: 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex; justify-content:space-between; gap:10px; align-items:center;
    }
    .card-t{font-weight:700; text-transform:uppercase; letter-spacing:.6px; font-size:.8rem; color:#eaeaea;}
    .pill{font-size:.72rem; color:var(--muted); border:1px solid rgba(255,255,255,.10); padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.03)}
    .card-b{padding: 12px;}
    .tabs{
      display:flex; gap:8px;
      padding: 10px 12px 0;
    }
    .tab{
      flex:1;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--txt);
      padding: 10px 12px;
      border-radius: 999px;
      cursor:pointer;
      font: inherit;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.6px;
      opacity:.85;
      white-space:nowrap;
    }
    .tab[aria-selected="true"]{background: var(--accent); color:#000; opacity:1; border-color: transparent;}
    form{display:flex; flex-direction:column; gap: 10px;}
    label{font-size:.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:.7px;}
    input, select{
      width:100%;
      background:#111;
      border:1px solid var(--border);
      color:var(--txt);
      padding: 11px 12px;
      border-radius: 12px;
      outline:none;
      font: inherit;
    }
    input:focus, select:focus{border-color: rgba(255,140,0,.6); box-shadow: 0 0 0 3px rgba(255,140,0,.12);}
    .row{display:flex; flex-direction:column; gap:6px;}
    .two{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    .hint{color:var(--muted); font-size:.82rem; line-height:1.35;}
    .colors{
      border:1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
      border-radius: 12px;
      padding: 10px;
      display:flex; flex-direction:column; gap:10px;
    }
    .colorline{display:flex; gap:10px; align-items:center;}
    input[type="color"]{width:44px;height:44px;padding:0;border:none;background:transparent; cursor:pointer;}
    .chk{display:flex; gap:10px; align-items:center; padding-top:2px;}
    .chk input{width:18px;height:18px; accent-color: var(--accent); cursor:pointer;}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:2px;}
    .btn{
      flex: 1 1 180px;
      border:0;
      border-radius: 12px;
      padding: 12px 12px;
      cursor:pointer;
      font: inherit;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.6px;
      min-height: 46px;
      white-space:nowrap;
    }
    .primary{background: var(--accent); color:#000;}
    .ghost{background: rgba(255,255,255,.05); color: var(--txt); border:1px solid rgba(255,255,255,.12);}
    .btn:active{transform:scale(.99)}

    .preview{
      display:flex; flex-direction:column; gap:10px; align-items:center; justify-content:center;
      padding: 12px;
    }
    .canvaswrap{
      width: min(320px, 100%);
      aspect-ratio: 1/1;
      border-radius: 16px;
      border:1px dashed rgba(255,255,255,.12);
      background: rgba(0,0,0,.35);
      padding: 12px;
      display:flex; align-items:center; justify-content:center;
    }
    canvas{width:100%; height:100%; display:block; border-radius: 12px;}
    .dl{
      color: var(--accent);
      text-decoration:none;
      border-bottom:1px solid rgba(255,140,0,.55);
      padding-bottom:2px;
      font-size:.88rem;
      display:none;
    }
    .status{color:var(--muted); text-align:center; font-size:.82rem; line-height:1.35; max-width: 44ch;}
    .hide{display:none !important;}

    /* Modal infos */
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.65);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 14px;
      z-index: 50;
    }
    .modal[aria-hidden="false"]{display:flex;}
    .modal-card{
      width:min(720px, 100%);
      border:1px solid var(--border);
      border-radius: 16px;
      background: #0b0b0b;
      box-shadow: 0 20px 60px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal-h{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.03);
    }
    .modal-title{
      font-weight:800;
      letter-spacing:.6px;
      text-transform:uppercase;
      font-size:.85rem;
      color:#eaeaea;
    }
    .modal-b{
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      color:#ddd;
      font-size: .9rem;
      line-height: 1.45;
    }
    .modal-b .muted{color: var(--muted);}
    .modal-b ul{padding-left: 18px; display:flex; flex-direction:column; gap:6px;}
    .modal-actions{padding: 0 14px 14px;}
    .close{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--txt);
      padding:10px 12px;
      border-radius: 999px;
      cursor:pointer;
      font: inherit;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:.6px;
      white-space:nowrap;
    }

    @media (max-width: 900px){
      .grid{grid-template-columns:1fr;}
      header{flex-wrap:wrap;}
      .header-actions{width:100%;}
      .chip{width:100%;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="title">QR — Color & Wi-Fi</div>
      <div class="header-actions">
        <button class="chip" type="button" id="infoBtn">ℹ Infos</button>
        <a class="chip" href="../../index.html">↩ Retour</a>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="tabs" role="tablist" aria-label="Choisir le type de QR">
          <button class="tab" id="tabColor" role="tab" aria-selected="true" aria-controls="panelColor">ColorQR</button>
          <button class="tab" id="tabWifi" role="tab" aria-selected="false" aria-controls="panelWifi">WiFiQR</button>
        </div>

        <div class="card-b">
          <div id="panelColor">
            <form id="formColor">
              <div class="row">
                <label for="url">Lien</label>
                <input id="url" type="text" inputmode="url" placeholder="https://..." value="https://archivefever.work/Projets/QR" />
                <div class="hint">Ce lien sera encodé dans le QR.</div>
              </div>

              <div class="colors">
                <div class="two">
                  <div class="row">
                    <label>Couleur principale</label>
                    <div class="colorline">
                      <input id="c1" type="color" value="#ff8c00" aria-label="Couleur principale" />
                      <input id="c1t" type="text" value="#ff8c00" spellcheck="false" />
                    </div>
                  </div>
                  <div class="row">
                    <label>Couleur secondaire</label>
                    <div class="colorline">
                      <input id="c2" type="color" value="#970000" aria-label="Couleur secondaire" />
                      <input id="c2t" type="text" value="#970000" spellcheck="false" />
                    </div>
                  </div>
                </div>

                <div class="chk">
                  <input id="m1" type="checkbox" checked />
                  <label for="m1" style="text-transform:none; letter-spacing:0; color:#ddd; font-size:.9rem;">
                    Bordure (marge) — améliore la détection
                  </label>
                </div>
              </div>

              <div class="btns">
                <button class="btn primary" type="button" id="genColor">Générer</button>
                <button class="btn ghost" type="button" id="swapC">Inverser</button>
                <button class="btn ghost" type="button" id="randC">Aléatoire</button>
              </div>

              <div class="hint">Le bouton “Aléatoire” change les 2 couleurs.</div>
            </form>
          </div>

          <div id="panelWifi" class="hide">
            <form id="formWifi">
              <div class="row">
                <label for="ssid">Nom du Wi-Fi (SSID)</label>
                <input id="ssid" type="text" placeholder="Nom de la box" required />
                <div class="hint">Le QR proposera la connexion à ce réseau.</div>
              </div>

              <div class="row">
                <label for="pass">Mot de passe</label>
                <input id="pass" type="password" placeholder="••••••••" />
                <div class="hint">Si “Aucune”, le mot de passe est ignoré.</div>
              </div>

              <div class="row">
                <label for="sec">Sécurité</label>
                <select id="sec">
                  <option value="WPA">WPA/WPA2</option>
                  <option value="WEP">WEP</option>
                  <option value="nopass">Aucune</option>
                </select>
                <div class="hint">Définit comment l’appareil se connecte.</div>
              </div>

              <div class="colors">
                <div class="two">
                  <div class="row">
                    <label>Couleur principale</label>
                    <div class="colorline">
                      <input id="w1" type="color" value="#ff8c00" />
                      <input id="w1t" type="text" value="#ff8c00" spellcheck="false" />
                    </div>
                  </div>
                  <div class="row">
                    <label>Couleur secondaire</label>
                    <div class="colorline">
                      <input id="w2" type="color" value="#970000" />
                      <input id="w2t" type="text" value="#970000" spellcheck="false" />
                    </div>
                  </div>
                </div>

                <div class="chk">
                  <input id="m2" type="checkbox" checked />
                  <label for="m2" style="text-transform:none; letter-spacing:0; color:#ddd; font-size:.9rem;">
                    Bordure (marge) — améliore la détection
                  </label>
                </div>
              </div>

              <div class="btns">
                <button class="btn primary" type="button" id="genWifi">Générer</button>
                <button class="btn ghost" type="button" id="swapW">Inverser</button>
                <button class="btn ghost" type="button" id="randW">Aléatoire</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <aside class="card">
        <div class="card-h">
          <div class="card-t">Aperçu</div>
          <div class="pill">256×256</div>
        </div>
        <div class="preview">
          <div id="previewBox" class="canvaswrap hide">
            <canvas id="canvas" width="256" height="256" aria-label="QR"></canvas>
          </div>
          <a id="dl" class="dl" download="qrcode.png" href="#">Télécharger</a>
          <div id="status" class="status">Rien à afficher pour l’instant. Clique sur “Générer”.</div>
        </div>
      </aside>
    </div>
  </div>

  <div class="modal" id="infoModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
    <div class="modal-card" role="document">
      <div class="modal-h">
        <div class="modal-title" id="infoTitle">Infos</div>
        <button class="close" type="button" id="closeInfo">Fermer</button>
      </div>
      <div class="modal-b">
        <p><strong>Créé par Fever</strong> — projet publié sur <strong>ArchiveFever.Work</strong>.</p>
        <p class="muted">
          Cet outil génère les QR codes <strong>localement dans ton navigateur</strong>.
          Les données que tu saisis (lien, SSID, mot de passe, couleurs) ne sont pas envoyées à un serveur par cet outil.
        </p>
        <ul>
          <li><strong>Respect de la vie privée :</strong> aucune collecte volontaire des QR codes / contenus par l’outil.</li>
          <li><strong>Usage :</strong> tu es responsable du contenu que tu choisis d’encoder (URL, texte, Wi-Fi, etc.).</li>
          <li><strong>Sécurité :</strong> un QR code peut pointer vers un contenu risqué (phishing, malware, arnaque…). Vérifie toujours avant de partager.</li>
          <li><strong>Responsabilité :</strong> Fever / ArchiveFever.Work ne peuvent pas être tenus responsables d’un usage malveillant fait par un tiers.</li>
        </ul>
        <p class="muted">
          Conseil : si tu diffuses un QR publiquement, teste-le sur plusieurs téléphones et évite les liens douteux.
        </p>
      </div>
      <div class="modal-actions"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    const $ = (id)=>document.getElementById(id);

    const modal = $("infoModal");
    const openInfo = ()=>{ modal.setAttribute("aria-hidden","false"); };
    const closeInfo = ()=>{ modal.setAttribute("aria-hidden","true"); };
    $("infoBtn").addEventListener("click", openInfo);
    $("closeInfo").addEventListener("click", closeInfo);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeInfo(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape" && modal.getAttribute("aria-hidden")==="false") closeInfo(); });

    function setMode(mode){
      const isColor = mode === "color";
      $("tabColor").setAttribute("aria-selected", String(isColor));
      $("tabWifi").setAttribute("aria-selected", String(!isColor));
      $("panelColor").classList.toggle("hide", !isColor);
      $("panelWifi").classList.toggle("hide", isColor);

      $("previewBox").classList.add("hide");
      $("dl").style.display = "none";
      $("status").textContent = "Rien à afficher pour l’instant. Clique sur “Générer”.";
    }
    $("tabColor").addEventListener("click", ()=>setMode("color"));
    $("tabWifi").addEventListener("click", ()=>setMode("wifi"));

    const isHex = (v)=>/^#([0-9a-f]{3}){1,2}$/i.test((v||"").trim());
    const contrast = (hex)=>{
      const c = hex.replace("#",""); const r=parseInt(c.slice(0,2),16), g=parseInt(c.slice(2,4),16), b=parseInt(c.slice(4,6),16);
      return ((r*299+g*587+b*114)/1000) > 140 ? "#000" : "#fff";
    };
    function paint(input){
      const v=input.value.trim(); if(!isHex(v)) return;
      input.style.background=v; input.style.color=contrast(v);
    }
    function bind(picker, text){
      const fromPicker=()=>{ text.value=picker.value; paint(text); };
      const fromText=()=>{ const v=text.value.trim(); if(isHex(v)){ picker.value=v; paint(text); } };
      picker.addEventListener("input", fromPicker);
      text.addEventListener("input", fromText);
      fromPicker();
    }

    bind($("c1"), $("c1t")); bind($("c2"), $("c2t"));
    bind($("w1"), $("w1t")); bind($("w2"), $("w2t"));

    function swap(p1,t1,p2,t2){
      const a=p1.value, b=p2.value;
      p1.value=b; p2.value=a;
      t1.value=b; t2.value=a;
      paint(t1); paint(t2);
    }
    $("swapC").addEventListener("click", ()=>swap($("c1"),$("c1t"),$("c2"),$("c2t")));
    $("swapW").addEventListener("click", ()=>swap($("w1"),$("w1t"),$("w2"),$("w2t")));

    function randHex(){
      const n = Math.floor(Math.random()*0xFFFFFF);
      return "#"+n.toString(16).padStart(6,"0");
    }
    function lum(hex){
      const c=hex.replace("#",""); const r=parseInt(c.slice(0,2),16), g=parseInt(c.slice(2,4),16), b=parseInt(c.slice(4,6),16);
      return (r*299+g*587+b*114)/1000;
    }
    function randomPair(){
      let a=randHex(), b=randHex(), tries=0;
      while (Math.abs(lum(a)-lum(b)) < 70 && tries < 40){
        b = randHex(); tries++;
      }
      return [a,b];
    }
    function applyColors(p1,t1,p2,t2){
      const [a,b]=randomPair();
      p1.value=a; t1.value=a; paint(t1);
      p2.value=b; t2.value=b; paint(t2);
    }
    $("randC").addEventListener("click", ()=>applyColors($("c1"),$("c1t"),$("c2"),$("c2t")));
    $("randW").addEventListener("click", ()=>applyColors($("w1"),$("w1t"),$("w2"),$("w2t")));

    const safeName = (s)=> (s||"qrcode")
      .replace(/https?:\/\//gi,"")
      .replace(/[^a-z0-9]+/gi,"_")
      .replace(/^_+|_+$/g,"")
      .slice(0,80) || "qrcode";

    async function renderQR(data, dark, light, margin, filename){
      $("dl").style.display = "none";
      $("status").textContent = "Génération…";
      try{
        await QRCode.toCanvas($("canvas"), data, {
          width: 256,
          margin: margin ? 1 : 0,
          color: { dark, light }
        });

        $("previewBox").classList.remove("hide");

        $("dl").href = $("canvas").toDataURL("image/png");
        $("dl").download = filename;
        $("dl").style.display = "inline";
        $("status").textContent = "QR prêt : tu peux télécharger.";
      }catch(err){
        console.error(err);
        $("status").textContent = "Erreur lors de la génération.";
        alert("Erreur lors de la génération du QR.");
      }
    }

    $("genColor").addEventListener("click", ()=>{
      const url = $("url").value.trim();
      if(!url) return alert("Entre un lien.");
      const dark = isHex($("c1").value) ? $("c1").value : "#000000";
      const light = isHex($("c2").value) ? $("c2").value : "#ffffff";
      renderQR(url, dark, light, $("m1").checked, `ColorQR_${safeName(url)}.png`);
    });
    $("formColor").addEventListener("submit",(e)=>{e.preventDefault(); $("genColor").click();});

    $("genWifi").addEventListener("click", ()=>{
      const ssid = $("ssid").value.trim();
      const pass = $("pass").value.trim();
      const sec  = $("sec").value;
      if(!ssid) return alert("Entre un SSID.");
      const data = `WIFI:T:${sec};S:${ssid};${sec!=="nopass" ? `P:${pass};` : ""};`;
      const dark = isHex($("w1").value) ? $("w1").value : "#000000";
      const light = isHex($("w2").value) ? $("w2").value : "#ffffff";
      renderQR(data, dark, light, $("m2").checked, `WiFiQR_${safeName(ssid)}.png`);
    });
    $("formWifi").addEventListener("submit",(e)=>{e.preventDefault(); $("genWifi").click();});

    setMode("color");
  </script>
</body>
</html>