<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURAL - ARCHIVEFEVER</title>
    <style>
        * { box-sizing: border-box; }
        html, body {
            background-color: black;
            color: white;
            font-family: ui-monospace, 'Cascadia Code', monospace;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        header {
            padding: 15px;
            text-align: center;
            flex-shrink: 0;
            border-bottom: 1px solid #111;
        }
        h1 { font-size: 12px; letter-spacing: 4px; margin: 0; opacity: 0.7; }
        .viewport {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            min-height: 0;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border: 1px solid #222;
        }
        .toolbar {
            background: #080808;
            border-top: 1px solid #222;
            padding: 20px;
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: flex-end;
            overflow-x: auto;
            flex-shrink: 0;
            -webkit-overflow-scrolling: touch;
        }
        .toolbar::-webkit-scrollbar { height: 4px; }
        .toolbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .input-group { display: flex; flex-direction: column; gap: 8px; flex-shrink: 0; }
        label { font-size: 9px; color: #555; text-transform: uppercase; white-space: nowrap; }
        input, select, button {
            background: #000;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            font-family: inherit;
            font-size: 12px;
            outline: none;
        }
        button { cursor: pointer; white-space: nowrap; font-weight: bold; padding: 10px 20px; }
        button:hover { background: white; color: black; }
        .btn-gen { background: white; color: black; }
        #customRes { display: none; gap: 8px; }
        .exit-btn {
            position: fixed;
            top: 12px;
            right: 12px;
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            padding: 6px 12px;
            text-decoration: none;
            color: #fff;
            font-size: 10px;
            z-index: 100;
        }
        @media (max-width: 768px) {
            .toolbar { justify-content: flex-start; padding: 15px; }
        }
    </style>
</head>
<body>

    <a href="index.html" class="exit-btn">Retour &rarr;</a>

    <header>
        <h1>NEURAL_ARCHIVE_CORE</h1>
    </header>

    <div class="viewport">
        <canvas id="neuralCanvas"></canvas>
    </div>

    <div class="toolbar">
        <div class="input-group">
            <label>Graine</label>
            <input type="text" id="seedInput" placeholder="Aléatoire" style="width: 120px;">
        </div>

        <div class="input-group">
            <label>Points</label>
            <input type="number" id="nodeInput" value="60" min="1" max="250" style="width: 70px;">
        </div>

        <div class="input-group">
            <label>Couleurs</label>
            <select id="colorMode">
                <option value="neon">NÉON (Multicolore)</option>
                <option value="binary">BINAIRE (Deux couleurs)</option>
                <option value="mono">MONO (Blanc sur fond noir)</option>
            </select>
        </div>

        <div class="input-group">
            <label>Format</label>
            <select id="formatSelect" onchange="toggleCustom()">
                <option value="landscape">16:9</option>
                <option value="ultrawide">21:9</option>
                <option value="square">1:1</option>
                <option value="portrait">9:16</option>
                <option value="custom">Perso</option>
            </select>
        </div>

        <div id="customRes" class="input-group">
            <label>L/H</label>
            <div style="display:flex; gap:5px;">
                <input type="number" id="customW" value="1920" style="width:65px;">
                <input type="number" id="customH" value="1080" style="width:65px;">
            </div>
        </div>

        <div class="input-group">
            <label>&nbsp;</label>
            <div style="display:flex; gap:10px;">
                <button onclick="resizeCanvas()" class="btn-gen">Généger</button>
                <button onclick="saveArchive()">Créer PNG</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('neuralCanvas');
        const ctx = canvas.getContext('2d');

        function toggleCustom() {
            const isCustom = document.getElementById('formatSelect').value === 'custom';
            document.getElementById('customRes').style.display = isCustom ? 'flex' : 'none';
        }

        function cyrb128(str) {
            let h1 = 1779033703, h2 = 277808939, h3 = 1457163285, h4 = 951274213;
            for (let i = 0, k; i < str.length; i++) {
                k = str.charCodeAt(i);
                h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
                h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
                h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
                h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
            }
            return [h1 >>> 0, h2 >>> 0, h3 >>> 0, h4 >>> 0];
        }

        function sfc32(a, b, c, d) {
            return function() {
                a >>>= 0; b >>>= 0; c >>>= 0; d >>>= 0; 
                var t = (a + b | 0) + d | 0;
                d = d + 1 | 0;
                a = b ^ b >>> 9;
                b = c + (c << 3) | 0;
                c = (c << 21 | c >>> 11);
                c = c + t | 0;
                return (t >>> 0) / 4294967296;
            }
        }

        function resizeCanvas() {
            const format = document.getElementById('formatSelect').value;
            if (format === 'landscape') { canvas.width = 1920; canvas.height = 1080; }
            else if (format === 'ultrawide') { canvas.width = 2560; canvas.height = 1080; }
            else if (format === 'square') { canvas.width = 1500; canvas.height = 1500; }
            else if (format === 'portrait') { canvas.width = 1080; canvas.height = 1920; }
            else if (format === 'custom') {
                canvas.width = parseInt(document.getElementById('customW').value) || 1000;
                canvas.height = parseInt(document.getElementById('customH').value) || 1000;
            }
            generateNeural();
        }

        function generateNeural() {
            let seedValue = document.getElementById('seedInput').value;
            let rand;
            if (!seedValue || seedValue.trim() === "") {
                const randomSeed = Math.random().toString(36).substring(7);
                const seedData = cyrb128(randomSeed);
                rand = sfc32(seedData[0], seedData[1], seedData[2], seedData[3]);
            } else {
                const seedData = cyrb128(seedValue);
                rand = sfc32(seedData[0], seedData[1], seedData[2], seedData[3]);
            }
            let inputVal = parseInt(document.getElementById('nodeInput').value);
            if (inputVal > 250) inputVal = 250;
            const mode = document.getElementById('colorMode').value;
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            const allColors = ['#00FBFF', '#FF00FF', '#FFFF00', '#FF3E11', '#FFFFFF'];
            let colors = (mode === 'neon') ? allColors : (mode === 'mono') ? ['#FFF'] : [allColors[Math.floor(rand()*5)], allColors[Math.floor(rand()*5)]];
            const nodes = [];
            for (let i = 0; i < inputVal; i++) {
                nodes.push({
                    x: rand() * canvas.width,
                    y: rand() * canvas.height,
                    color: colors[Math.floor(rand() * colors.length)],
                    radius: 2 + rand() * 4
                });
            }
            ctx.lineWidth = 1;
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    const d = Math.hypot(nodes[i].x - nodes[j].x, nodes[i].y - nodes[j].y);
                    if (d < canvas.width / 4.5) { 
                        ctx.beginPath();
                        ctx.strokeStyle = nodes[i].color;
                        ctx.globalAlpha = (1 - (d / (canvas.width / 4.5))) * 0.5;
                        ctx.moveTo(nodes[i].x, nodes[i].y);
                        ctx.lineTo(nodes[j].x, nodes[j].y);
                        ctx.stroke();
                    }
                }
            }
            ctx.globalAlpha = 1;
            nodes.forEach(n => {
                ctx.beginPath();
                ctx.fillStyle = n.color;
                ctx.shadowBlur = 15; ctx.shadowColor = n.color;
                ctx.arc(n.x, n.y, n.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            });
        }

        function saveArchive() {
            const link = document.createElement('a');
            link.download = `NEURAL_${new Date().getTime()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        resizeCanvas();
    </script>
</body>
</html>